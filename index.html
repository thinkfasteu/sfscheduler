<!DOCTYPE html>
<html>
<head>
    <title>FTG Tools</title>
    <!-- CSP hardened: inline scripts removed -->
    <!-- Note: frame-ancestors ignored in meta (needs HTTP header); removed here to silence console warning. Add via server header when deployed. -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src 'self' https://cdnjs.cloudflare.com; style-src 'self'; img-src 'self' data: blob:; connect-src 'self' https://aoryovdttdujfunectpx.supabase.co https: wss://aoryovdttdujfunectpx.supabase.co; font-src 'self'; worker-src 'self' blob:; object-src 'none'; base-uri 'self'; form-action 'self';" />
    <link rel="stylesheet" href="./ui/styles.css">
        <link rel="icon" href="data:;base64,iVBORw0KGgo=">
            <!-- Explicit config.local.js inclusion (loads before boot if present) -->
            <!--<script src="./config.local.js" data-optional="true"></script>// -->
            <!-- Hashed bundle loader moved to external file for CSP compliance -->
            <script src="./dist/runtime-config.js" data-generated="true"></script>
            <script type="module" src="./boot.js"></script>
























</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-brand">
                <h1>Dienstplan-System Pro</h1>
                <p>Schichtplanung</p>
            </div>
            <div class="header-actions">
                <button id="themeToggle" class="btn btn-secondary" title="Dark Mode umschalten">üåô Dark Mode</button>
                <button id="exportBackupBtn" class="btn btn-secondary" title="Daten sichern">‚¨áÔ∏è Backup</button>
                <button id="importBackupBtn" class="btn btn-secondary" title="Backup importieren">‚¨ÜÔ∏è Import</button>
                <input type="file" id="backupFileInput" accept="application/json" class="hidden" />
            </div>
        </div>
    <!-- Backend fallback banner now injected dynamically via __banner when needed -->

        <div class="tabs">
            <button class="tab active" data-tab="staff">Personalverwaltung</button>
            <button class="tab" data-tab="availability">Verf√ºgbarkeiten</button>
            <button class="tab" data-tab="schedule">Dienstplan</button>
            <button class="tab" data-tab="vacation">Urlaub</button>
            <button class="tab" data-tab="reports">Berichte</button>
            <button class="tab" data-tab="logs">Protokolle</button>
        </div>

        <div class="tab-content">
            <div id="staff-tab" class="section active">
                <h2>Personalverwaltung</h2>
                <div class="form-group staff-card">
                    <h3 id="staffFormTitle">Neue Arbeitskraft hinzuf√ºgen</h3>
                    <input type="hidden" id="staffIdToEdit" />
                    <div class="form-row">
                        <input type="text" id="staffName" placeholder="Name" />
                        <select id="staffType">
                            <option value="minijob">Minijob</option>
                            <option value="student">Werkstudent</option>
                            <option value="permanent">Festangestellt</option>
                        </select>
                        <input type="number" id="contractHours" placeholder="Std/Woche" />
                        <input type="number" id="typicalWorkdays" placeholder="Tage/Woche" />
                    </div>
                    <div class="form-row hidden" id="permanentPreferredRow">
                        <label>Bevorzugter Schichttyp (Festangestellte)</label>
                        <select id="permanentPreferredShift">
                            <option value="none">Keine Pr√§ferenz</option>
                            <option value="early">Fr√ºh</option>
                            <option value="midday">Mittel</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label class="inline align-center gap-8">
                            <input type="checkbox" id="weekendPreference" />
                            <span>Bevorzugt Wochenendschichten</span>
                        </label>
                    </div>
                    <h4>Urlaubszeitr√§ume</h4>
                    <div class="form-row grid-cols-1fr-1fr-auto align-end">
                        <div><label>Von</label><input type="date" id="staffVacationStart" /></div>
                        <div><label>Bis</label><input type="date" id="staffVacationEnd" /></div>
                        <button id="addStaffVacationBtn" class="btn btn-secondary">Urlaub hinzuf√ºgen</button>
                    </div>
                    <ul id="staffVacationList"></ul>

                    <h4>Krankheitszeitr√§ume</h4>
                    <div class="form-row grid-cols-1fr-1fr-auto align-end">
                        <div><label>Von</label><input type="date" id="staffIllnessStart" /></div>
                        <div><label>Bis</label><input type="date" id="staffIllnessEnd" /></div>
                        <button id="addStaffIllnessBtn" class="btn btn-secondary">Krankmeldung hinzuf√ºgen</button>
                    </div>
                    <ul id="staffIllnessList"></ul>
                    <div class="form-row">
                        <button id="saveStaffBtn" class="btn">Arbeitskraft speichern</button>
                        <button id="cancelEditBtn" class="btn btn-secondary hidden">Abbrechen</button>
                    </div>
                </div>
                <div id="staffList" class="form-row"></div>
            </div>

            <div id="availability-tab" class="section">
                <h2>Verf√ºgbarkeiten / Freiw√ºnsche</h2>
                <div class="controls form-row availability-controls">
                    <div>
                        <label>Mitarbeiter</label>
                        <select id="availabilityStaffSelect"></select>
                    </div>
                    <div>
                        <label>Monat</label>
                        <select id="availabilityMonth"></select>
                    </div>
                    <button id="showHolidaysBtn" class="btn btn-secondary">Feiertage</button>
                </div>
                <div id="availabilityForm"><p>Bitte Mitarbeiter und Monat ausw√§hlen.</p></div>
            </div>

            <div id="schedule-tab" class="section">
                <h2>Dienstplan</h2>
                <div class="controls form-row grid-cols-2fr-auto-1fr-1fr-1fr-1fr gap-8 align-center">
                    <select id="scheduleMonth"></select>
                    <label class="inline align-center gap-6">
                        <input type="checkbox" id="studentExceptionCheckbox" />
                        <span>Kurzfristige Ausnahme zulassen (Werkstudent)</span>
                    </label>
                    <label class="inline align-center gap-6">
                        <input type="checkbox" id="showChecklistToggle" checked />
                        <span>Checkliste anzeigen</span>
                    </label>
                    <button id="generateScheduleBtn" class="btn btn-success">Dienstplan erstellen</button>
                    <button id="clearScheduleBtn" class="btn btn-danger">Plan l√∂schen</button>
                    <button id="exportScheduleBtn" class="btn">Export CSV</button>
                    <button id="exportPdfBtn" class="btn">PDF Export</button>
                    <button id="printScheduleBtn" class="btn">Drucken</button>
                </div>
                <div class="controls form-row grid-cols-auto-1fr align-center mt-6">
                    <label class="inline align-center gap-6">
                        <input type="checkbox" id="studentFairnessCheckbox" />
                        <span>Fairness-Modus: Gew√ºnschte Arbeitstage respektieren (Werkstudenten)</span>
                    </label>
                </div>
                <div id="scheduleContent" class="overflow-x-auto"></div>
                <div id="weekendReport" class="mt-16"></div>
                <div class="staff-card mt-16">
                    <h3>Wochenend-√úberstunden Anfragen</h3>
                    <p class="text-muted">Anfragen f√ºr Wochenendschichten von Festangestellten (nur bei unbesetzbaren Schichten)</p>
                    <div id="overtimeRequestsList"></div>
                </div>
            </div>

            <div id="vacation-tab" class="section">
                <h2>Urlaub</h2>
                <div class="form-row grid-cols-auto-1fr align-center mb-8">
                    <label>Jahr</label>
                    <select id="vacationYearSelect"></select>
                </div>
                <div class="overflow-x-auto">
                    <table class="table table-collapse w-100">
                        <thead>
                            <tr>
                                <th class="text-left">Mitarbeiter</th>
                                <th>Urlaubsanspruch</th>
                                <th>Urlaub genommen (manuell)</th>
                                <th>√úbertrag (Vorjahr)</th>
                                <th>Urlaub geplant</th>
                                <th>Urlaub verbleibend</th>
                                <th>Krank gemeldet (Jahr)</th>
                                <th>Aktion</th>
                            </tr>
                        </thead>
                        <tbody id="vacationLedgerTable"></tbody>
                    </table>
                </div>
                <div class="form-row grid-cols-1fr-1fr-1fr-1fr align-end">
                    <div>
                        <label>Mitarbeiter</label>
                        <select id="vacationStaffSelect"></select>
                    </div>
                    <div><label>Von</label><input type="date" id="vacationStart" /></div>
                    <div><label>Bis</label><input type="date" id="vacationEnd" /></div>
                    <button id="addVacationPeriodBtn" class="btn btn-secondary">Urlaub hinzuf√ºgen</button>
                </div>
                <ul id="vacationList"></ul>

                <hr class="mt-16 mb-16"/>
                <h3>Weitere Mitarbeitende (nur Urlaube)</h3>
                <div class="form-group staff-card">
                    <div class="form-row grid-cols-1fr-auto align-end">
                        <div>
                            <label>Name</label>
                            <input type="text" id="otherStaffName" placeholder="Name" />
                        </div>
                        <button id="addOtherStaffBtn" class="btn">Mitarbeitende speichern</button>
                    </div>
                    <h4>Urlaubszeitr√§ume</h4>
                    <div class="form-row grid-cols-1fr-1fr-auto align-end">
                        <div>
                            <label>Von</label>
                            <input type="date" id="otherVacationStart" />
                        </div>
                        <div>
                            <label>Bis</label>
                            <input type="date" id="otherVacationEnd" />
                        </div>
                        <button id="addOtherVacationPeriodBtn" class="btn btn-secondary">Urlaub hinzuf√ºgen</button>
                    </div>
                    <ul id="otherVacationList"></ul>
                </div>
                <div id="otherStaffList" class="form-row"></div>
            </div>

            <div id="reports-tab" class="section">
                <h2>Berichte</h2>
                <div class="controls form-row grid-cols-auto-1fr gap-8 align-center">
                    <label>Monat</label>
                    <select id="reportsMonth"></select>
                </div>
                <div class="mt-12">
                    <h3>Stunden√ºbersicht f√ºr <span id="hoursReportMonthLabel"></span></h3>
                    <div class="overflow-x-auto">
                        <table class="table table-collapse w-100">
                            <thead>
                                <tr>
                                    <th class="text-left">Mitarbeiter</th>
                                    <th>Typ</th>
                                    <th>Stunden</th>
                                    <th>√úberstunden</th>
                                    <th>Verdienst (ca.)</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="monthlyHoursReport"></tbody>
                        </table>
                    </div>
                </div>
                <div class="mt-18">
                    <h3>Werkstudent Wochen√ºbersicht</h3>
                    <div class="overflow-x-auto">
                        <table class="table table-collapse w-100">
                            <thead>
                                <tr>
                                    <th class="text-left">Name</th>
                                    <th>KW</th>
                                    <th>Stunden</th>
                                    <th>WE/Nacht-Anteil %</th>
                                    <th>Ausnahme (WS)</th>
                                </tr>
                            </thead>
                            <tbody id="studentWeeklyReport"></tbody>
                        </table>
                    </div>
                </div>
                <div class="mt-18">
                    <h3>√úberstunden (Festangestellte) ‚Äì <span id="otReportMonthLabel"></span></h3>
                    <div class="overflow-x-auto">
                        <table class="table table-collapse w-100">
                            <thead>
                                <tr>
                                    <th class="text-left">Name</th>
                                    <th>KW</th>
                                    <th>√úberstunden (h)</th>
                                </tr>
                            </thead>
                            <tbody id="overtimeCreditsReport"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="logs-tab" class="section">
                <h2>√Ñnderungsprotokoll</h2>
                <div class="overflow-x-auto">
                    <table class="table table-collapse w-100">
                        <thead>
                            <tr>
                                <th class="text-left">Zeitstempel</th>
                                <th>Aktion</th>
                            </tr>
                        </thead>
                        <tbody id="auditLogTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>
<!-- PDF export libraries -->
<!-- External libraries with SRI (integrity placeholders to be replaced with real hashes) -->
<!-- Holidays Modal -->
<div id="holidaysModal" class="modal">
    <div class="modal-content narrow">
        <div class="modal-header">
            <h3>Feiertage verwalten</h3>
            <button id="holidaysModalCloseBtn" class="btn btn-secondary">Schlie√üen</button>
        </div>
    <div class="form-row grid-cols-1fr-2fr-1fr mt-8">
            <div>
                <label>Jahr</label>
                <select id="holidaysYear"></select>
            </div>
            <div class="flex gap-8 align-end">
                <div>
                    <label>Datum</label>
                    <input type="date" id="holidayDate" />
                </div>
                <div>
                    <label>Name</label>
                    <input type="text" id="holidayName" placeholder="Feiertag" />
                </div>
            </div>
            <div>
                <button id="addHolidayBtn" class="btn">Hinzuf√ºgen</button>
            </div>
        </div>
        <ul id="holidaysList" class="mt-12"></ul>
        <hr/>
        <div>
            <h4>Vorlesungszeiten (ICS)</h4>
            <p>Optional: URL eines ICS-Kalenders mit Vorlesungs- und vorlesungsfreien Zeiten.</p>
            <div class="form-row grid-cols-1fr-auto align-end">
                <input type="url" id="icsUrlInput" placeholder="https://‚Ä¶/academic.ics" />
                <button id="addIcsSourceBtn" class="btn">Hinzuf√ºgen</button>
            </div>
            <ul id="icsSourcesList" class="mt-8"></ul>
            <div class="mt-8">
                <button id="refreshAcademicTermsBtn" class="btn btn-secondary">Vorlesungszeiten laden/aktualisieren</button>
            </div>
        </div>
    </div>
</div>
</div>

<!-- Assignment/Swap Modal -->
<div id="swapModal" class="modal">
    <div class="modal-content wide">
        <div class="modal-header">
            <h3 id="swapTitle">Zuweisung</h3>
            <button id="swapModalCloseBtn" class="btn btn-secondary">Schlie√üen</button>
        </div>
    <div id="swapDetail" class="mt-8 mb-12"></div>
        <div class="form-row grid-2col">
            <div>
                <label>Schicht</label>
                <select id="swapShiftSelect"></select>
                <div id="currentAssignment" class="mt-8 notes"></div>
            </div>
            <div>
                <label>Kandidaten</label>
                <select id="swapStaffSelect"></select>
                <div id="candidateNotes" class="mt-8 notes"></div>
                        <div id="includePermanentsRow" class="hidden mt-8">
                            <label class="inline">
                                <input type="checkbox" id="includePermanentsCheckbox" />
                                <span>Auch Festangestellte f√ºr Wochenendschichten ber√ºcksichtigen</span>
                            </label>
                        </div>
                <div id="consentRow" class="hidden mt-8">
                    <label class="inline">
                        <input type="checkbox" id="consentCheckbox" />
                        <span id="consentLabel">Zustimmung f√ºr diesen Tag anfragen</span>
                    </label>
                    <div id="consentHint" class="hint hidden mt-4">
                        Bei Zustimmung werden diese Wochenendstunden als √úberstunden gez√§hlt (au√üerhalb des Wochenziels).
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="executeSwapBtn" class="btn btn-secondary">Wechseln</button>
            <button id="executeAssignBtn" class="btn btn-success">Zuweisen</button>
            <button id="leaveBlankBtn" class="btn">Leer lassen</button>
        </div>
        <div id="assignHint" class="hint mt-8">
            Hinweis: Es werden nur f√ºr den Tag zul√§ssige Schichten angeboten (Wochenende/Feiertag/werktags). Zuweisungen werden automatisch validiert.
        </div>
    </div>
</div>
</html>
</html>
    <!-- Scheduling Checklist Overlay Root -->
    <div id="scheduleChecklistRoot" aria-live="polite"></div>
<!-- Search & Assign Modal -->
<div id="searchModal" class="modal">
    <div class="modal-content wide">
        <div class="modal-header">
            <h3 id="searchTitle">Suchen & Zuweisen</h3>
            <button id="searchModalCloseBtn" class="btn btn-secondary">Schlie√üen</button>
        </div>
    <div id="searchDetail" class="mt-8 mb-12"></div>
        <div class="form-row grid-2col">
            <div>
                <label>Schicht</label>
                <select id="searchShiftSelect"></select>
            </div>
            <div>
                <label>Mitarbeiter</label>
                <input type="text" id="searchFilterInput" placeholder="Suchen (Name, Rolle)" />
                <select id="searchStaffSelect" class="mt-8"></select>
                <div id="searchCandidateNotes" class="mt-8 notes"></div>
                <div id="searchIncludePermanentsRow" class="hidden mt-8">
                    <label class="inline">
                        <input type="checkbox" id="searchIncludePermanentsCheckbox" />
                        <span>Auch Festangestellte f√ºr Wochenendschichten ber√ºcksichtigen</span>
                    </label>
                </div>
                <div id="searchConsentRow" class="hidden mt-8">
                    <label class="inline">
                        <input type="checkbox" id="searchConsentCheckbox" />
                        <span id="searchConsentLabel">Zustimmung f√ºr diesen Tag anfragen</span>
                    </label>
                    <div id="searchConsentHint" class="hint hidden mt-4">
                        Bei Zustimmung werden diese Wochenendstunden als √úberstunden gez√§hlt (au√üerhalb des Wochenziels).
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="searchLeaveBlankBtn" class="btn">Leer lassen</button>
            <button id="executeSearchAssignBtn" class="btn btn-success">Zuweisen</button>
        </div>
        <div class="hint mt-8">
            Hinweis: Kandidatenliste basiert auf Regeln und Verf√ºgbarkeiten; Blocker werden als Hinweis angezeigt und verhindern die Zuweisung.
        </div>
    </div>
</div>
