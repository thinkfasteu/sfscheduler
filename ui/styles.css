.mb-12 { margin-bottom:12px; }
/* Replaced with modern design system and dark mode */
/* Design tokens */
:root {
    /* Light theme tweaked for a bit more contrast */
    --bg: #eef2f7;
    --card: #ffffff;
    --text: #111827;
    --muted: #4b5563;
    --border: #d1d5db;
    --brand: #0d6efd;
    --brand-600: #0b5ed7;
    --success: #2ca54a;
    --danger: #dc3545;
    --warning: #f59e0b;
    --surface: #f8fafc; /* subtle surface */
    --badge-bg: #fff3cd; /* replaces --badge */
    --badge-fg: #7c5e10;
    --shadow: 0 8px 20px rgba(0,0,0,.08);
}

[data-theme="dark"] {
    /* Dark mode softened with layered greys */
    --bg: #111827;   /* slate-900 */
    --card: #1f2937; /* slate-800 */
    --text: #e5e7eb; /* slate-200 */
    --muted: #9aa4b2;
    --border: #2b3643; /* slate-700 */
    --brand: #de5a5a;
    --brand-600: #d04d58;
    --success: #22c55e;
    --danger: #ef4444;
    --warning: #f59e0b;
    --surface: #0f172a; /* slate-950 */
    --badge-bg: rgba(245,158,11,0.22); /* amber tint */
    --badge-fg: #facc15;               /* amber-400 */
    --shadow: 0 8px 24px rgba(0,0,0,.35);
}

html, body { background: var(--bg); color: var(--text); }
.container { max-width: 1200px; margin: 24px auto; background: var(--card); border-radius: 12px; box-shadow: var(--shadow); overflow: hidden; border: 1px solid var(--border); }
.header { background: linear-gradient(135deg, var(--brand), var(--brand-600)); color: #fff; padding: 16px 20px; display:flex; align-items:center; justify-content:space-between; }
.header-brand h1 { margin: 0; font-size: 20px; }
.header-brand p { margin: 2px 0 0 0; opacity: .9; }
.header-actions { display:flex; gap:8px; }

.tabs { display: flex; gap: 6px; background: rgba(0,0,0,0.02); border-bottom: 1px solid var(--border); padding: 8px; }
.tab { padding: 10px 14px; border: 1px solid var(--border); background: var(--card); cursor: pointer; color: var(--muted); border-radius: 8px; }
.tab.active { background: var(--brand); color: #fff; border-color: transparent; }
.tab-content { padding: 20px; }
.section { display: none; }
.section.active { display: block; }

.form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; }
.staff-card { background: var(--card); padding: 16px; border-radius: 10px; border: 1px solid var(--border); box-shadow: var(--shadow); position:relative; }
/* Utilities for card layout and controls */
.card-row { display:flex; align-items:flex-start; justify-content:space-between; gap: 12px; flex-wrap:wrap; }
.card-row > div:first-child { flex:1 1 180px; min-width:180px; }
.card-row .btn-group { flex:0 0 auto; display:flex; gap:8px; flex-wrap:wrap; }
.card-row .btn-group .btn { flex:1 1 auto; }

/* Staff list container: responsive wrapping grid */
#staffList { display:grid; gap:14px; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); align-items:stretch; }

/* Badges inside staff card - wrap nicely */
.staff-card .badge { display:inline-block; margin:4px 6px 0 0; }
.staff-card strong { display:inline-block; margin-right:6px; }

/* Ensure buttons never overflow horizontally */
.staff-card .btn-group { width:100%; justify-content:flex-end; }
@media (max-width:600px){
    .staff-card .btn-group { justify-content:flex-start; }
}
.card-col { display:flex; flex-direction:column; gap: 10px; }
.btn-group { display:flex; gap:8px; }
.form-row.toggles { align-items:center; grid-template-columns: 1fr; }
.form-row.compact { align-items:center; grid-template-columns: auto auto auto; }
.form-row.compact.disabled { opacity:.6; }
.inline { display:flex; align-items:center; gap:8px; }
input[type="text"], input[type="number"], input[type="date"], input[type="url"], select { width: 100%; padding: 8px 10px; border: 1px solid var(--border); border-radius: 8px; background: var(--card); color: var(--text); }
label { color: var(--muted); font-size: .95em; }

.btn { background: var(--brand); color: #fff; border: none; padding: 9px 12px; border-radius: 8px; cursor: pointer; box-shadow: 0 1px 0 rgba(255,255,255,.15) inset; }
.btn:hover { filter: brightness(0.98); }
.btn-success { background: var(--success); }
.btn-danger { background: var(--danger); }
.btn-secondary { background: #4b5563; }
.btn-sm { padding: 6px 8px; font-size: .9em; border-radius: 6px; }

.cal { display: grid; gap: 8px; }
.cal-row { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
.cal-cell { min-height: 96px; border: 1px solid var(--border); border-radius: 10px; padding: 8px; background: var(--card); box-shadow: var(--shadow); }
.cal-head .cal-head-cell { background: #111827; color: #fff; font-weight: 600; text-align: center; min-height: auto; border-radius: 8px; }
.cal-weekend { background: rgba(13,110,253,0.06); }
.cal-empty { background: rgba(0,0,0,0.03); }
[data-theme="dark"] .cal-head .cal-head-cell { background: #2a3646; }
[data-theme="dark"] .table thead tr { background: rgba(255,255,255,0.06); }
[data-theme="dark"] .table tbody tr:nth-child(odd) { background: rgba(255,255,255,0.03); }
[data-theme="dark"] .cal-weekend { background: rgba(96,165,250,0.08); }
[data-theme="dark"] .cal-empty { background: rgba(255,255,255,0.02); }
.cal-date { font-weight: 600; color: var(--text); display:flex; align-items:center; justify-content:space-between; }
.cal-weekend { background: rgba(13,110,253,0.06); }
.cal-empty { background: rgba(0,0,0,0.03); }

.staff-assignment { display: inline-flex; align-items: center; gap: 6px; background: #e3f2fd; color: #1565c0; padding: 4px 8px; border-radius: 14px; margin: 2px; font-size: 0.9em; border: 1px solid rgba(21,101,192,.2); }
[data-theme="dark"] .staff-assignment { background: rgba(96,165,250,.15); color: #93c5fd; border-color: rgba(96,165,250,.3); }
.badge { font-size: 0.75em; background: var(--badge-bg); color: var(--badge-fg); padding: 2px 6px; border-radius: 10px; border: 1px solid rgba(0,0,0,0.06); }

.avail-grid { display: grid; gap: 8px; }
.avail-row { display: grid; grid-template-columns: 1.2fr 4fr 0.9fr 0.9fr 0.8fr; gap: 8px; align-items:center; }
.avail-cell { border: 1px solid var(--border); border-radius: 8px; padding: 8px; background: var(--card); text-align:center; box-shadow: var(--shadow); }
.avail-head .avail-cell { background:#111827; color:#fff; font-weight:600; }
.avail-btn { width: 100%; padding: 6px 8px; border: 1px solid var(--border); border-radius:8px; cursor:pointer; background: rgba(0,0,0,0.03); color: var(--text); }
.avail-btn.state-yes { background: rgba(34,197,94,.15); border-color: rgba(34,197,94,.4); }
.avail-btn.state-prefer { background: rgba(245,158,11,.15); border-color: rgba(245,158,11,.4); }
.avail-btn.state-no { background: rgba(239,68,68,.15); border-color: rgba(239,68,68,.4); }
.avail-btn.state-unset { background: rgba(0,0,0,0.03); color: var(--muted); }
.is-weekend { background: rgba(13,110,253,0.06); }
.is-holiday { background: rgba(245,158,11,.12); }
.na-cell { opacity: 0.7; font-style: italic; }
.day-flag { font-size: 0.8em; margin-left: 6px; padding: 2px 6px; border-radius: 10px; background: rgba(0,0,0,.08); }

.table { width: 100%; border: 1px solid var(--border); border-radius: 10px; overflow: hidden; }
.table thead tr { background: rgba(0,0,0,0.06); }
.table th, .table td { padding: 10px 12px; border-bottom: 1px solid var(--border); text-align: center; }
.table tbody tr:nth-child(odd) { background: rgba(0,0,0,0.02); }

ul { padding-left: 18px; }
ul#holidaysList, ul#icsSourcesList { padding-left: 0; margin: 0; display: grid; gap: 8px; }
ul#staffVacationList, ul#staffIllnessList, ul#otherVacationList { padding-left: 0; margin: 0; display: grid; gap: 8px; }
li { margin: 6px 0; }
.list-item { display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border:1px solid var(--border); border-radius:8px; background: var(--card); box-shadow: var(--shadow); list-style: none; }

/* Modal system (replaces inline styles for CSP hardening) */
.modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:10000; overflow-y:auto; -webkit-overflow-scrolling:touch; }
.modal.open { display:block; }
.modal-content { background: var(--card); margin: 8vh auto; padding:16px; border-radius:10px; width:640px; max-width:95vw; box-shadow: var(--shadow); }
.modal-content.narrow { width:600px; }
.modal-content.wide { width:740px; }
.modal-header { display:flex; justify-content:space-between; align-items:center; gap:12px; }
.modal-footer { margin-top:14px; display:flex; gap:8px; justify-content:flex-end; }
.muted { color: var(--muted); }
.mt-8 { margin-top:8px; }
.mt-12 { margin-top:12px; }
.mt-16 { margin-top:16px; }
.hidden { display:none !important; }
.scroll-y { overflow-y:auto; }

/* Inline-removed structural helpers (trimmed) */
.grid-2col { display:grid; grid-template-columns:1fr 1fr; gap:12px; align-items:start; }
/* Standardized column pattern utilities */
.grid-cols-1fr-2fr-1fr { display:grid; grid-template-columns:1fr 2fr 1fr; gap:12px; align-items:end; }
.notes { font-size:0.9em; color:#677684; }
[data-theme="dark"] .notes { color: var(--muted); }
.hint { font-size:0.85em; color:#677684; }
[data-theme="dark"] .hint { color: var(--muted); }

/* Utility layout & spacing (for CSP inline removal) */
.flex { display:flex; }
.flex-wrap { flex-wrap:wrap; }
.jc-end { justify-content:flex-end; }
.gap-8 { gap:8px; }
.mb-8 { margin-bottom:8px; }
.mt-4 { margin-top:4px; }
.mt-neg-4 { margin-top:-4px; }
.ml-6 { margin-left:6px; }
.full-width { flex:1 0 100%; }
.text-small { font-size:0.85em; line-height:1.3; }
.pre-wrap { white-space:pre-wrap; }
.fw-600 { font-weight:600; }
.fs-13 { font-size:13px; }
.fs-90 { font-size:0.9em; }
.fs-85 { font-size:0.85em; }
.mb-4 { margin-bottom:4px; }
.p-12 { padding:12px; }
.w-120 { width:120px; }
.italic { font-style:italic; }
.shift-btn { margin:2px 6px 2px 0; }
.no-scroll { overflow:hidden !important; }
.avail-cols-permanent { grid-template-columns: 1.2fr 3.2fr 0.9fr 0.9fr 0.8fr; }
.avail-cols-regular { grid-template-columns: 1.2fr 4fr; }

/* Extended spacing & layout utilities */
.mt-6 { margin-top:6px; }
.mt-12 { margin-top:12px; }
.mt-16 { margin-top:16px; }
.mt-18 { margin-top:18px; }
.mb-16 { margin-bottom:16px; }
.ml-auto { margin-left:auto; }
.w-100 { width:100%; }
.overflow-x-auto { overflow-x:auto; }
.text-left { text-align:left; }
.text-center { text-align:center; }
.text-muted { color:#677684; }
[data-theme="dark"] .text-muted { color: var(--muted); }
.border-left-warning { border-left:4px solid var(--warning); }
.flex-between { display:flex; justify-content:space-between; }
.flex-gap-6 { display:flex; gap:6px; }
.flex-gap-8 { display:flex; gap:8px; }
.gap-6 { gap:6px; }
.gap-10 { gap:10px; }
.inline-flex { display:inline-flex; }
.align-center { align-items:center; }
.align-end { align-items:end; }
.grid-cols-1fr-1fr-auto { display:grid; grid-template-columns:1fr 1fr auto; }
.grid-cols-1fr-1fr-1fr-1fr { display:grid; grid-template-columns:repeat(4,1fr); }
.grid-cols-1fr-1fr-auto-auto { display:grid; grid-template-columns:1fr 1fr auto auto; }
.grid-cols-2fr-auto-1fr-1fr-1fr-1fr { display:grid; grid-template-columns:2fr auto 1fr 1fr 1fr 1fr; }
.grid-cols-1fr-auto { display:grid; grid-template-columns:1fr auto; }
.grid-cols-auto-1fr { display:grid; grid-template-columns:auto 1fr; }
.grid-cols-auto-120px-auto-auto { display:grid; grid-template-columns:auto 120px auto auto; }
.nowrap { white-space:nowrap; }
.hidden { display:none !important; }

/* Table helpers */
.table-collapse { border-collapse:collapse; }

/* Cards / contextual blocks */
.card-inline { background: var(--card); border:1px solid var(--border); border-radius:10px; padding:12px; box-shadow: var(--shadow); }
.accent-warning { background: rgba(245,158,11,.08); }

/* State / badges overrides */
.badge-info { background:#0dcaf0; color:#00303d; }
.error-note { color:#b02a37; font-size:0.9em; margin-top:4px; }
/* Toast / notifications */
.toast-container { position:fixed; bottom:16px; right:16px; display:flex; flex-direction:column; gap:8px; z-index:3000; }
.toast { background:#333; color:#fff; padding:10px 14px; border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,.25); font:14px system-ui; min-width:260px; display:flex; flex-direction:column; gap:6px; }
.toast-warning { background:#ffc107; color:#222; }
.toast.fade-out { opacity:0; transition:opacity .6s; }
/* Compact toast variant */
.toast-sm { font-size:12px; padding:6px 10px; min-width:auto; }
/* Banners */
.app-banner { position:fixed; top:0; left:50%; transform:translateX(-50%); background:var(--brand); color:#fff; padding:6px 14px; font:13px system-ui; border-radius:0 0 8px 8px; box-shadow:0 4px 10px rgba(0,0,0,.15); z-index:3600; display:flex; align-items:center; gap:8px; }
.app-banner.warn { background:var(--warning); color:#222; }
.app-banner.error { background:var(--danger); }
.app-banner button.close { background:transparent; border:none; color:inherit; font-size:16px; cursor:pointer; line-height:1; }

/* Scheduling Checklist Overlay */
#scheduleChecklistRoot { position:fixed; top:16px; right:16px; z-index:3200; max-width:340px; font:13px system-ui; }
.checklist-panel { background: var(--card); color: var(--text); border:1px solid var(--border); box-shadow: var(--shadow); border-radius:10px; padding:14px 16px; display:flex; flex-direction:column; gap:10px; animation:cl-enter .4s ease; }
@media (prefers-reduced-motion: reduce){ .checklist-panel { animation:none; } }
@keyframes cl-enter { from { opacity:0; transform:translateY(-6px); } to { opacity:1; transform:translateY(0); } }
.checklist-header { display:flex; align-items:center; gap:8px; }
.checklist-header h4 { margin:0; font-size:14px; flex:1; }
.checklist-close { background:transparent; border:none; cursor:pointer; color:var(--muted); font-size:16px; line-height:1; padding:2px 4px; }
.checklist-steps { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:6px; }
.checklist-steps li { display:flex; align-items:flex-start; gap:6px; }
.cl-step-label { flex:1; }
.cl-step-status { font-weight:600; font-size:11px; text-transform:uppercase; letter-spacing:.5px; }
.cl-status-pending { color: var(--muted); }
.cl-status-ok { color: var(--success); }
.cl-status-error { color: var(--danger); }
.cl-flags { background: rgba(245,158,11,.14); border:1px solid var(--warning); padding:8px; border-radius:8px; font-size:12px; max-height:140px; overflow:auto; }
[data-theme="dark"] .cl-flags { background: rgba(245,158,11,.15); }
.cl-flag-item { margin:0 0 4px 0; padding:0; line-height:1.3; }
.cl-summary { font-size:12px; color:var(--muted); }
.cl-progress { height:4px; background:rgba(0,0,0,.1); border-radius:3px; overflow:hidden; }
.cl-progress-bar { height:100%; width:0%; background:linear-gradient(90deg,var(--brand),var(--brand-600)); transition:width .4s ease; }
@media (prefers-reduced-motion: reduce){ .cl-progress-bar { transition:none; } }

.modal .modal-content { border: 1px solid var(--border); box-shadow: var(--shadow); }
.modal h3 { margin: 0; }
.modal .form-row { margin-top: 8px; }
.tab-nav {
    margin-bottom: 20px;
}

.tab-button {
    padding: 10px 20px;
    border: none;
    background: #f0f0f0;
    cursor: pointer;
}

.tab-button.active {
    background: #007bff;
    color: white;
}

/* Modular fallback only: hide/show contents injected after .tab-nav */
.tab-nav ~ .tab-content {
    display: none;
}

.tab-nav ~ .tab-content.active {
    display: block;
}

@media (prefers-color-scheme: dark) {
    :root:not([data-theme]) { background: #0f172a; }
}

/* Loading & status UI */
.spinner { width:14px; height:14px; border:2px solid rgba(0,0,0,.15); border-top-color: var(--brand); border-radius:50%; display:inline-block; animation:spin .8s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }
.status-line { display:flex; align-items:center; gap:8px; color: var(--muted); font-size: 0.9em; margin: 6px 0 10px; }

/* Pilot Mode Monitoring Styles */
.pilot-badge {
    background: #ff6b35;
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: bold;
    margin-left: 10px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
}

/* === CSP Inline Style Replacements === */
#tabLockStatus { position:fixed; bottom:8px; right:8px; font:11px system-ui; padding:4px 8px; border-radius:4px; background:#0d6efd; color:#fff; z-index:3000; opacity:.92; display:flex; align-items:center; gap:6px; }
.fade-out { opacity:0 !important; transition: opacity .6s; }
.inline-banner { position:fixed; top:8px; left:50%; transform:translateX(-50%); background:#198754; color:#fff; padding:4px 10px; font:12px system-ui; border-radius:4px; z-index:5000; box-shadow:0 2px 6px rgba(0,0,0,.3); }
.inline-banner.warn { background:#ffc107; color:#222; }
.inline-banner.error { background:var(--danger); }
.boot-error-banner { position:fixed; top:0; left:0; right:0; background:#ffdede; color:#222; padding:6px 10px; font:13px system-ui; z-index:3500; box-shadow:0 2px 4px rgba(0,0,0,.2); display:flex; align-items:center; gap:8px; }
.supabase-warning-bar { position:fixed; top:0; left:0; right:0; z-index:2000; background:#ffc107; color:#222; padding:6px 10px; font:14px system-ui; box-shadow:0 2px 4px rgba(0,0,0,.2); }
.monitoring-notification { position:fixed; top:72px; right:16px; background:var(--card); color:var(--text); border:1px solid var(--border); box-shadow:var(--shadow); padding:10px 14px; border-radius:8px; font:13px system-ui; z-index:3400; width:320px; display:flex; flex-direction:column; gap:6px; }
.debug-float-btn { position:fixed; top:10px; right:10px; z-index:9999; }

/* Progress bar width buckets (avoid inline width) */
.cl-progress-bar { width:0%; }
.w-pct-0 { width:0%; }
.w-pct-20 { width:20%; }
.w-pct-40 { width:40%; }
.w-pct-60 { width:60%; }
.w-pct-80 { width:80%; }
.w-pct-100 { width:100%; }

.btn-pilot {
    background: #ff6b35;
    color: white;
    border: none;
}

.btn-pilot:hover {
    background: #e55a2b;
}

.pilot-alerts {
    margin: 15px 0;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #ff6b35;
}

.pilot-alerts.success {
    background: #f8f9fa;
    border-color: #28a745;
}

.pilot-alerts.has-warnings {
    background: #fff3cd;
    border-color: #ffc107;
}

.pilot-alerts.has-critical {
    background: #f8d7da;
    border-color: #dc3545;
}

.pilot-alert {
    margin: 10px 0;
    padding: 12px;
    border-radius: 6px;
    border: 1px solid #ddd;
}

.pilot-alert.warning {
    background: #fff3cd;
    border-color: #ffeaa7;
}

.pilot-alert.critical {
    background: #f8d7da;
    border-color: #f5c6cb;
}

.alert-header {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
    font-weight: bold;
}

.alert-icon {
    margin-right: 8px;
    font-size: 16px;
}

.alert-title {
    flex: 1;
    margin-right: 10px;
}

.alert-time {
    font-size: 12px;
    color: #666;
    font-weight: normal;
}

.alert-message {
    margin: 8px 0;
    color: #444;
}

.alert-actions {
    margin-top: 10px;
}

.btn-xs {
    padding: 4px 8px;
    font-size: 11px;
    border-radius: 3px;
}

/* Modal + checklist interaction layering */
/* Ensure checklist sits below modal baseline but can still appear above other UI (adjusted via .modal-open class) */
#scheduleChecklistRoot .checklist-panel { z-index: 500; }
.modal.open { z-index: 10000; }
/* When any modal is open (class added via JS helper), disable pointer events so checklist does not steal clicks */
#scheduleChecklistRoot.modal-open .checklist-panel { pointer-events: none; }
/* Hide schedule controls when modal is open to prevent overlay issues */
body.no-scroll #scheduleControls { display: none !important; }

.btn-help {
    background: #6c757d;
    color: white;
    border: none;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: help;
}

.pilot-metrics-section {
    margin: 20px 0;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #dee2e6;
}

.section-header {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
}

.section-header h3 {
    margin: 0;
    flex: 1;
}

.pilot-metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.pilot-metric {
    display: flex;
    align-items: center;
    padding: 12px;
    background: white;
    border-radius: 6px;
    border: 1px solid #dee2e6;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.metric-icon {
    font-size: 24px;
    margin-right: 12px;
}

.metric-info {
    flex: 1;
}

.metric-title {
    font-size: 12px;
    color: #666;
    margin-bottom: 4px;
}

.metric-value {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 2px;
}

.metric-value.success {
    color: #28a745;
}

.metric-value.warning {
    color: #ffc107;
}

.metric-value.error {
    color: #dc3545;
}

.metric-detail {
    font-size: 11px;
    color: #999;
}

.alerts-container {
    max-height: 300px;
    overflow-y: auto;
}

/* Tab lock status styling */
.tab-lock-status {
    position: fixed;
    top: 10px;
    right: 10px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 12px;
    z-index: 1000;
    box-shadow: var(--shadow);
}

.tab-lock-status .fw-600 {
    font-weight: 600;
}

.tab-lock-status .text-muted {
    color: var(--muted);
    margin-left: 4px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .pilot-metrics-grid {
        grid-template-columns: 1fr;
    }
    
    .alert-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .alert-time {
        margin-top: 4px;
    }
}

/* Schedule validation styles */
.staff-assignment.invalid-assignment {
    border: 2px solid var(--danger);
    background-color: rgba(220, 53, 69, 0.1);
}
